services:
  qa-service:
    build:
      context: .  # Build from current directory (qa/)
      dockerfile: Dockerfile
    container_name: sec-filings-qa
    ports:
      - "8000:8000"  # Map host port 8000 to container port 8000
    environment:
      - PORT=8000
      - FLASK_DEBUG=false
      # ChromaDB configuration (override with .env file)
      - CHROMA_API_KEY=${CHROMA_API_KEY}
      - CHROMA_TENANT=${CHROMA_TENANT}
      - CHROMA_DATABASE=${CHROMA_DATABASE}
      - CHROMA_COLLECTION_NAME=${CHROMA_COLLECTION_NAME:-sec_filings}
      # LLM configuration
      - LLM_PROVIDER=${LLM_PROVIDER:-gemini}
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      # RAG configuration
      - RAG_TOP_K=${RAG_TOP_K:-20}
      - RERANK_MAX_LENGTH=${RERANK_MAX_LENGTH:-512}
      - ENABLE_RERANKING=${ENABLE_RERANKING:-true}
      # Config path
      - CONFIG_PATH=/app/config.yaml
    env_file:
      - .env
    volumes:
      # Mount config.yaml if you want to update it without rebuilding
      - ./config.yaml:/app/config.yaml:ro
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

